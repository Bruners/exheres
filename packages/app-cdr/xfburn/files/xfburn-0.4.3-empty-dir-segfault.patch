From daf64c0727a9ae1d0dae084de339012395c2cdea Mon Sep 17 00:00:00 2001
From: Lasse Brun <bruners@gmail.com>
Date: Sat, 25 Feb 2012 04:56:43 +0100
Subject: [PATCH] Description: Patch to avoid segfault when adding new
 directory

Origin: other, https://bugzilla.xfce.org/attachment.cgi?id=3541

Bug: https://bugzilla.xfce.org/show_bug.cgi?id=6805
---
 xfburn/xfburn-data-composition.c |   37 +++++++++++++++++++------------------
 1 files changed, 19 insertions(+), 18 deletions(-)

diff --git a/xfburn/xfburn-data-composition.c b/xfburn/xfburn-data-composition.c
index d4204f7..1bb2cc1 100644
--- a/xfburn/xfburn-data-composition.c
+++ b/xfburn/xfburn-data-composition.c
@@ -1852,26 +1852,27 @@ fill_image_with_composition (GtkTreeModel *model, IsoImage *image, IsoDir * pare
           g_error ("Failed adding %s as a node to the image: code %X!", src, r);
       }
 
-      basename = g_path_get_basename (src);
-
-      /* check if the file has been renamed */
-      if (strcmp (basename, name) != 0) {
-        /* rename the iso_node */
-        r = iso_node_set_name (node, name);
-
-        if (r == 0) {
-          /* The first string is the renamed name, the second one the original name */
-	  xfce_dialog_show_warning(NULL, NULL, _("Duplicate filename '%s' for '%s'"), name, src);
-
-          g_free (basename);
-          g_free (name);
-          g_free (src);
-
-          continue;
+      /* Check names only for items not manually created (#613563) */
+      if (type != DATA_COMPOSITION_TYPE_DIRECTORY || src != NULL) {
+        basename = g_path_get_basename (src);
+
+        /* check if the file has been renamed */
+        if (strcmp (basename, name) != 0) {
+          /* rename the iso_node */
+          r = iso_node_set_name (node, name);
+
+          if (r == 0) {
+            /* The first string is the renamed name, the second one the original name */
+            xfce_dialog_show_warning(NULL, NULL, _("Duplicate filename '%s' for '%s'"), name, src);
+
+            g_free (basename);
+            g_free (name);
+            g_free (src);
+            continue;
+          }
         }
+        g_free (basename);
       }
-
-      g_free (basename);
       g_free (name);
       g_free (src);

--
1.7.8.1
